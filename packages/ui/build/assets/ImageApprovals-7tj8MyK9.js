import{u as L,r as i,j as e,L as u,f as h,b as r,X as D,t as m}from"./index-DHtPeL_b.js";import{C as l,a as d,b as A,c as F,f as U,B as v}from"./button-CjhLNr1v.js";import{B as E}from"./badge-HVe6nmkD.js";import{m as B,n as R,o as $}from"./dashboard-CTd77nbb.js";import{C as K}from"./check-W4AsGZoT.js";const X=()=>{const{isDarkMode:o}=L(),[c,p]=i.useState([]),[N,x]=i.useState(new Set),[y,g]=i.useState(!0),[j,f]=i.useState(null);i.useEffect(()=>{(async()=>{try{g(!0),f(null);const a=(await B()).map(t=>({imageKey:t.imageKey,imageName:t.imageName,status:t.approved?"approved":"denied",lastUpdated:t.lastUpdated?new Date(t.lastUpdated).toLocaleString():void 0}));p(a)}catch(n){console.error("Failed to fetch container images:",n),f(n instanceof Error?n.message:"Failed to load images"),m.error("Failed to load container images")}finally{g(!1)}})()},[]);const C=async(s,n)=>{x(a=>new Set([...a,s]));try{await R(s),p(a=>a.map(t=>t.imageKey===s?{...t,status:"approved",lastUpdated:new Date().toLocaleString()}:t)),m.success(`Image "${n}" approved successfully`)}catch(a){console.error("Failed to approve image:",a),m.error(`Failed to approve "${n}"`)}finally{x(a=>{const t=new Set(a);return t.delete(s),t})}},b=async(s,n)=>{x(a=>new Set([...a,s]));try{await $(s),p(a=>a.map(t=>t.imageKey===s?{...t,status:"denied",lastUpdated:new Date().toLocaleString()}:t)),m.success(`Image "${n}" denied successfully`)}catch(a){console.error("Failed to deny image:",a),m.error(`Failed to deny "${n}"`)}finally{x(a=>{const t=new Set(a);return t.delete(s),t})}},w=s=>{switch(s){case"approved":return{backgroundColor:o?r.success[900]:r.success[50],borderColor:o?r.success[700]:r.success[200],textColor:o?r.success[200]:r.success[700]};case"denied":return{backgroundColor:o?r.error[900]:r.error[50],borderColor:o?r.error[700]:r.error[200],textColor:o?r.error[200]:r.error[700]};default:return{backgroundColor:o?r.warning[900]:r.warning[50],borderColor:o?r.warning[700]:r.warning[200],textColor:o?r.warning[200]:r.warning[700]}}},I=c.filter(s=>s.status==="pending").length,k=c.filter(s=>s.status==="approved").length,S=c.filter(s=>s.status==="denied").length;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-foreground mb-1",children:"Image Approvals"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage image approval status for container security"})]}),y&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(u,{className:"h-4 w-4 animate-spin"}),"Loading..."]})]}),j&&e.jsx(l,{className:"border-red-500",children:e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(h,{className:"h-5 w-5 text-text-error shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-text-error",children:"Error loading images"}),e.jsx("p",{className:"text-sm text-text-error",children:j})]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(l,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-warning-600 mb-2",children:I}),e.jsx("p",{className:"text-muted-foreground",children:"Pending Review"})]})})}),e.jsx(l,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-success-600 mb-2",children:k}),e.jsx("p",{className:"text-muted-foreground",children:"Approved"})]})})}),e.jsx(l,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-error-600 mb-2",children:S}),e.jsx("p",{className:"text-muted-foreground",children:"Denied"})]})})})]}),e.jsxs(l,{children:[e.jsxs(A,{children:[e.jsx(F,{children:"Container Images"}),e.jsx(U,{children:"Review and approve container images before they can be used"})]}),e.jsx(d,{children:e.jsx("div",{className:"space-y-3",children:c.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(h,{className:"h-8 w-8 text-muted-foreground mx-auto mb-2"}),e.jsx("p",{className:"text-muted-foreground",children:"No images to review"})]}):c.map(s=>{const n=N.has(s.imageKey),a=w(s.status);return e.jsxs("div",{style:{backgroundColor:a.backgroundColor,borderColor:a.borderColor},className:"rounded-lg border p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[e.jsx("p",{className:"font-medium",style:{color:a.textColor},children:s.imageName}),e.jsx(E,{variant:"outline",style:{backgroundColor:s.status==="approved"?r.success[100]:s.status==="denied"?r.error[100]:r.warning[100],color:s.status==="approved"?r.success[700]:s.status==="denied"?r.error[700]:r.warning[700],borderColor:s.status==="approved"?r.success[200]:s.status==="denied"?r.error[200]:r.warning[200]},children:s.status==="approved"?"Approved":s.status==="denied"?"Denied":"Pending"})]}),e.jsx("p",{className:"text-sm",style:{color:a.textColor,opacity:.8},children:s.imageKey}),s.lastUpdated&&e.jsxs("p",{className:"text-xs mt-1",style:{color:a.textColor,opacity:.6},children:["Last updated: ",s.lastUpdated]})]}),e.jsxs("div",{className:"flex gap-2 ml-4",children:[e.jsxs(v,{size:"sm",variant:s.status==="approved"?"default":"outline",onClick:()=>C(s.imageKey,s.imageName),disabled:n,children:[n?e.jsx(u,{className:"h-4 w-4 animate-spin"}):e.jsx(K,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline ml-1",children:"Approve"})]}),e.jsxs(v,{size:"sm",variant:s.status==="denied"?"default":"outline",onClick:()=>b(s.imageKey,s.imageName),disabled:n,children:[n?e.jsx(u,{className:"h-4 w-4 animate-spin"}):e.jsx(D,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline ml-1",children:"Deny"})]})]})]},s.imageKey)})})})]}),e.jsx(l,{style:{backgroundColor:o?r.info[900]:r.info[50],borderColor:o?r.info[700]:r.info[200]},children:e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(h,{className:"h-5 w-5 shrink-0 mt-0.5",style:{color:o?r.info[300]:r.info[600]}}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm mb-1",style:{color:o?r.info[200]:r.info[700]},children:"Image Approval Policy"}),e.jsx("p",{className:"text-sm",style:{color:o?r.info[300]:r.info[600]},children:"Approved images can be deployed to containers. Denied images will be prevented from running. Review the security scan results before approving any image."})]})]})})})]})};export{X as ImageApprovals};
