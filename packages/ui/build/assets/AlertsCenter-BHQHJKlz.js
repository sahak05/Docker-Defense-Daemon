import{r as o,j as e,b as r,g as A,u as z,L as P,t as S}from"./index-DHtPeL_b.js";import{C as v,a as N,B as b}from"./button-CjhLNr1v.js";import{c as Q,d as Y,e as Z}from"./dashboard-CTd77nbb.js";import{d as _}from"./dataValidation-CHBJZzj5.js";import{C as T}from"./circle-x-DfhPwigA.js";import{T as L}from"./triangle-alert-DHBtnb5P.js";import{C as H}from"./clock-C90gIM--.js";import{I as $}from"./index-D5fRsFHl.js";import{S as ee,a as E,b as B,c as M,d as W,e as f,T as se,f as re,g as D,h as p,i as te,j as g}from"./table-Da8j9RYo.js";import{D as le,E as ae}from"./eye-D9frdCNw.js";import{B as C}from"./badge-HVe6nmkD.js";import{D as ne,a as oe,b as ce,c as ie,d as de,e as ue}from"./dialog-quAqh7LN.js";import{C as R}from"./circle-check-CA32e_Ns.js";import"./index-Dv7bi_y4.js";import"./Combination-Cw94Wu9k.js";import"./check-W4AsGZoT.js";const xe=s=>{const[n,i]=o.useState([]),[d,l]=o.useState(!0),[t,m]=o.useState(null),c=o.useRef(!0),h=o.useRef(!1),j=o.useRef(null),w=o.useCallback(async()=>{if(!h.current){h.current=!0;try{if(!c.current)return;l(!0);const u=await Q();if(!c.current)return;const x=_(u||[]);i(x),m(null)}catch(u){if(!c.current)return;const x=u instanceof Error?u.message:"Unknown error";console.error("Alerts fetch failed:",x),m(x)}finally{c.current&&(l(!1),h.current=!1)}}},[]);return o.useEffect(()=>(c.current=!0,w(),()=>{c.current=!1,j.current&&clearInterval(j.current)}),[w]),o.useEffect(()=>{},[s,w]),{alerts:n,loading:d,error:t,refetch:w}},me=({alerts:s})=>{const n=s.filter(l=>l.severity==="critical").length,i=s.filter(l=>l.severity==="warning").length,d=s.filter(l=>l.status==="new").length;return e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsx(v,{children:e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Critical"}),e.jsx("p",{className:"text-foreground",children:n})]}),e.jsx("div",{style:{backgroundColor:r.error[50]},className:"h-10 w-10 rounded-lg flex items-center justify-center",children:e.jsx(T,{className:"h-5 w-5",style:{color:A("neutral",600)}})})]})})}),e.jsx(v,{children:e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Warning"}),e.jsx("p",{className:"text-foreground",children:i})]}),e.jsx("div",{style:{backgroundColor:r.warning[50]},className:"h-10 w-10 rounded-lg flex items-center justify-center",children:e.jsx(L,{className:"h-5 w-5",style:{color:A("neutral",600)}})})]})})}),e.jsx(v,{children:e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"New Alerts"}),e.jsx("p",{className:"text-foreground",children:d})]}),e.jsx("div",{style:{backgroundColor:r.info[50]},className:"h-10 w-10 rounded-lg flex items-center justify-center",children:e.jsx(H,{className:"h-5 w-5",style:{color:A("neutral",600)}})})]})})})]})},he=({searchTerm:s,onSearchChange:n,severityFilter:i,onSeverityChange:d,statusFilter:l,onStatusChange:t})=>e.jsx(v,{children:e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ee,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx($,{placeholder:"Search alerts by type, container, or description...",value:s,onChange:m=>n(m.target.value),className:"pl-9"})]}),e.jsxs(E,{value:i,onValueChange:d,children:[e.jsx(B,{className:"w-full sm:w-40",children:e.jsx(M,{placeholder:"Severity"})}),e.jsxs(W,{children:[e.jsx(f,{value:"all",children:"All Severity"}),e.jsx(f,{value:"critical",children:"Critical"}),e.jsx(f,{value:"warning",children:"Warning"}),e.jsx(f,{value:"info",children:"Info"})]})]}),e.jsxs(E,{value:l,onValueChange:t,children:[e.jsx(B,{className:"w-full sm:w-40",children:e.jsx(M,{placeholder:"Status"})}),e.jsxs(W,{children:[e.jsx(f,{value:"all",children:"All Status"}),e.jsx(f,{value:"new",children:"New"}),e.jsx(f,{value:"acknowledged",children:"Acknowledged"}),e.jsx(f,{value:"resolved",children:"Resolved"})]})]}),e.jsx(b,{variant:"outline",size:"icon",tokenStyles:!0,children:e.jsx(le,{className:"h-4 w-4"})})]})})});function V(s,n){return s?s.length>n?s.slice(0,n)+"...":s:""}const fe=({alerts:s,onSelectAlert:n,getSeverityStyle:i,getAlertStatusStyle:d,getStatusIcon:l})=>e.jsx(v,{children:e.jsx(N,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(se,{children:[e.jsx(re,{children:e.jsxs(D,{children:[e.jsx(p,{style:{maxWidth:"200px"},children:"Alert Type"}),e.jsx(p,{children:"Container"}),e.jsx(p,{children:"Severity"}),e.jsx(p,{children:"Status"}),e.jsx(p,{children:"Timestamp"}),e.jsx(p,{className:"text-right",children:"Actions"})]})}),e.jsx(te,{children:s.length===0?e.jsx(D,{children:e.jsx(g,{colSpan:6,className:"text-center py-8",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(L,{className:"h-8 w-8 text-muted-foreground"}),e.jsx("p",{className:"text-muted-foreground",children:"No alerts found"})]})})}):s.map(t=>e.jsxs(D,{className:"hover:bg-muted/50",children:[e.jsx(g,{style:{maxWidth:"150px"},children:e.jsxs("div",{className:"truncate",children:[e.jsx("p",{className:"text-foreground truncate font-medium",title:t.type,children:t.type}),e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-1",children:V(t.description,100)})]})}),e.jsx(g,{children:e.jsx(C,{variant:"outline",className:"text-xs",tokenStyles:!0,children:t.container})}),e.jsx(g,{children:e.jsx(C,{tokenStyles:!0,variant:"outline",style:{backgroundColor:i(t.severity).backgroundColor,color:i(t.severity).color,borderColor:i(t.severity).borderColor},children:t.severity})}),e.jsx(g,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[l(t.status),e.jsx(C,{variant:"outline",style:{...d(t.status),padding:"0.15rem 0.5rem"},children:t.status})]})}),e.jsx(g,{className:"text-muted-foreground text-sm",children:new Date(t.timestamp).toLocaleString()}),e.jsx(g,{className:"text-right",children:e.jsx(b,{variant:"ghost",size:"sm",onClick:()=>n(t),children:e.jsx(ae,{className:"h-4 w-4"})})})]},t.id))})]})})})}),je=({alert:s,open:n,onOpenChange:i,onAcknowledge:d,onResolve:l,getSeverityStyle:t,getAlertStatusStyle:m,isLoading:c=!1})=>{const{isDarkMode:h}=z();return s?e.jsx(ne,{open:n,onOpenChange:i,children:e.jsxs(oe,{className:"max-w-2xl overflow-y-auto",children:[e.jsxs(ce,{children:[e.jsx(ie,{className:"wrap-break-word",children:s.type}),e.jsxs(de,{children:["Alert ID: ",s.id]})]}),e.jsxs("div",{className:"space-y-4 overflow-y-auto max-h-[60vh]",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx(C,{variant:"outline",style:{backgroundColor:t(s.severity).backgroundColor,color:t(s.severity).color,borderColor:t(s.severity).borderColor},children:s.severity}),e.jsx(C,{variant:"outline",style:{...m(s.status)},children:s.status}),e.jsx(C,{variant:"outline",children:s.container})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Description"}),e.jsx("p",{className:"text-foreground wrap-break-word overflow-wrap-anywhere whitespace-pre-wrap w-full",style:{wordBreak:"break-word",overflowWrap:"anywhere",whiteSpace:"pre-wrap",maxWidth:"100%"},children:V(s.description,500)})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Details"}),e.jsx("p",{className:"text-foreground wrap-break-word w-full overflow-wrap",children:s.details})]}),s.suggestedAction&&e.jsxs("div",{style:{backgroundColor:h?r.neutral[100]:r.info[50],borderColor:h?r.neutral[700]:r.info[200]},className:"rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Suggested Action"}),e.jsx("p",{className:"text-sm text-foreground wrap-break-word w-full",style:{color:A("neutral",600)},children:s.suggestedAction})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Timestamp"}),e.jsx("p",{className:"text-foreground",children:new Date(s.timestamp).toLocaleString()})]})]}),e.jsx(ue,{children:e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto flex-wrap",children:[s.status==="new"&&e.jsxs(b,{variant:"outline",onClick:d,disabled:c,children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"Acknowledge"]}),s.status!=="resolved"&&e.jsxs(b,{onClick:l,disabled:c,children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"Mark as Resolved"]})]})})]})}):null},Ie=()=>{const{isDarkMode:s}=z(),{alerts:n,loading:i,error:d,refetch:l}=xe(),[t,m]=o.useState(""),[c,h]=o.useState("all"),[j,w]=o.useState("all"),[u,x]=o.useState(null),[O,k]=o.useState(!1),U=o.useMemo(()=>n.filter(a=>{const y=a.type.toLowerCase().includes(t.toLowerCase())||a.container.toLowerCase().includes(t.toLowerCase())||a.description.toLowerCase().includes(t.toLowerCase()),J=c==="all"||a.severity===c,K=j==="all"||a.status===j;return y&&J&&K}),[n,t,c,j]),F=a=>{switch(a){case"critical":return{backgroundColor:r.error[100],color:r.error[700],borderColor:r.error[200]};case"warning":return{backgroundColor:r.warning[100],color:r.warning[700],borderColor:r.warning[200]};case"info":return{backgroundColor:r.info[100],color:r.info[700],borderColor:r.info[200]};default:return{backgroundColor:s?r.neutral[800]:r.neutral[100],color:s?r.neutral[100]:r.neutral[700],borderColor:s?r.neutral[700]:r.neutral[200]}}},X=a=>{switch(a){case"new":return e.jsx(H,{className:"h-4 w-4"});case"acknowledged":return e.jsx(L,{className:"h-4 w-4"});case"resolved":return e.jsx(R,{className:"h-4 w-4"});default:return e.jsx(T,{className:"h-4 w-4"})}},I=a=>{switch(a){case"new":return{backgroundColor:s?r.error[700]:r.error[100],color:s?r.error[50]:r.error[700],borderColor:s?r.error[600]:r.error[200]};case"acknowledged":return{backgroundColor:s?r.warning[700]:r.warning[100],color:s?r.warning[50]:r.warning[700],borderColor:s?r.warning[600]:r.warning[200]};case"resolved":return{backgroundColor:s?r.success[700]:r.success[100],color:s?r.success[50]:r.success[700],borderColor:s?r.success[600]:r.success[200]};default:return{backgroundColor:s?r.neutral[800]:r.neutral[100],color:s?r.neutral[100]:r.neutral[700],borderColor:s?r.neutral[700]:r.neutral[200]}}},q=async()=>{if(u){k(!0);try{await Z(u.id),S.success("Alert acknowledged"),x(null),l()}catch(a){console.error("Failed to acknowledge alert:",a);const y=a.message?.includes("not found")?"Alert not found. Refreshing list...":"Failed to acknowledge alert";S.error(y),a.message?.includes("not found")&&(x(null),l())}finally{k(!1)}}},G=async()=>{if(u){k(!0);try{await Y(u.id),S.success("Alert marked as resolved"),x(null),l()}catch(a){console.error("Failed to resolve alert:",a);const y=a.message?.includes("not found")?"Alert not found. Refreshing list...":"Failed to resolve alert";S.error(y),a.message?.includes("not found")&&(x(null),l())}finally{k(!1)}}};return e.jsxs("div",{className:"space-y-6 text-foreground",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-foreground mb-1",children:"Alerts Center"}),e.jsx("p",{className:"text-muted-foreground",children:"Review and manage security and anomaly alerts"})]}),i&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(P,{className:"h-4 w-4 animate-spin"}),"Loading..."]})]}),d&&e.jsx(v,{className:"border-red-500",children:e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(T,{className:"h-5 w-5 text-text-error shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-text-error",children:"Error loading alerts"}),e.jsx("p",{className:"text-sm text-text-error",children:d}),e.jsx(b,{size:"sm",variant:"outline",onClick:()=>l(),className:"mt-2",children:"Try Again"})]})]})})}),e.jsx(me,{alerts:n}),e.jsx(he,{searchTerm:t,onSearchChange:m,severityFilter:c,onSeverityChange:h,statusFilter:j,onStatusChange:w}),e.jsx(fe,{alerts:U,onSelectAlert:x,getSeverityStyle:F,getAlertStatusStyle:I,getStatusIcon:X}),e.jsx(je,{alert:u,open:!!u,onOpenChange:()=>x(null),onAcknowledge:q,onResolve:G,getSeverityStyle:F,getAlertStatusStyle:I,isLoading:O})]})};export{Ie as AlertsCenter};
