import{r as t,j as e,u as L,i as k,g as h,b as A,t as S}from"./index-DHtPeL_b.js";import{C as g,a as v,B as C}from"./button-CjhLNr1v.js";import{l as I}from"./dashboard-CTd77nbb.js";import{d as B}from"./dataValidation-CHBJZzj5.js";import{I as D}from"./index-D5fRsFHl.js";import{S as F,a as H,b as M,c as O,d as V,e as E,T as $,f as q,g as y,h as p,i as z,j as f}from"./table-Da8j9RYo.js";import{R}from"./refresh-cw-BYpHREaA.js";import{B as T}from"./badge-HVe6nmkD.js";import"./index-Dv7bi_y4.js";import"./Combination-Cw94Wu9k.js";import"./check-W4AsGZoT.js";const P=(r,l,s,o)=>{const[c,u]=t.useState([]),[n,i]=t.useState(!0),[N,w]=t.useState(null),d=t.useRef(!0),x=t.useRef(!1),m=t.useRef(null),a=t.useCallback(async()=>{if(!x.current){x.current=!0;try{if(!d.current)return;i(!0);const j=await I(o,l,s);if(!d.current)return;const b=B(j||[]);u(b),w(null)}catch(j){if(!d.current)return;const b=j instanceof Error?j.message:"Unknown error";console.error("Events fetch failed:",b),w(b)}finally{d.current&&(i(!1),x.current=!1)}}},[o,l,s]);return t.useEffect(()=>(d.current=!0,a(),()=>{d.current=!1,m.current&&clearInterval(m.current)}),[a]),t.useEffect(()=>{if(r&&r>0)return m.current=setInterval(()=>{a()},r),()=>{m.current&&clearInterval(m.current)}},[r,a]),{events:c,loading:n,error:N,refetch:a}},U=({searchTerm:r,onSearchChange:l,typeFilter:s,onTypeFilterChange:o,uniqueTypes:c,onRefresh:u,isLoading:n})=>e.jsx(g,{children:e.jsx(v,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(F,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(D,{placeholder:"Search events by message, type, or container...",value:r,onChange:i=>l(i.target.value),className:"pl-9"})]}),e.jsxs(H,{value:s,onValueChange:o,children:[e.jsx(M,{className:"w-full sm:w-48",children:e.jsx(O,{placeholder:"Event Type"})}),e.jsxs(V,{children:[e.jsx(E,{value:"all",children:"All Types"}),c.map(i=>e.jsx(E,{value:i,children:i},i))]})]}),e.jsxs(C,{variant:"outline",onClick:u,disabled:n,children:[e.jsx(R,{className:`h-4 w-4 mr-2 ${n?"animate-spin":""}`}),"Refresh"]})]})})}),G=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"h-8 w-32 bg-muted rounded mb-2 animate-pulse"}),e.jsx("div",{className:"h-4 w-48 bg-muted rounded animate-pulse"})]}),e.jsx(g,{children:e.jsx(v,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"h-10 bg-muted rounded animate-pulse"})}),e.jsx("div",{className:"w-full sm:w-48",children:e.jsx("div",{className:"h-10 bg-muted rounded animate-pulse"})}),e.jsx("div",{className:"h-10 w-20 bg-muted rounded animate-pulse"})]})})}),e.jsx(g,{children:e.jsx(v,{className:"p-0",children:e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsx("div",{className:"grid grid-cols-5 gap-4 pb-3 border-b",children:[1,2,3,4,5].map(r=>e.jsx("div",{className:"h-4 bg-muted rounded animate-pulse"},r))}),[1,2,3,4,5].map(r=>e.jsx("div",{className:"grid grid-cols-5 gap-4",children:[1,2,3,4,5].map(l=>e.jsx("div",{className:"h-8 bg-muted rounded animate-pulse"},l))},r))]})})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"h-4 w-40 bg-muted rounded animate-pulse"}),e.jsx("div",{className:"h-4 w-48 bg-muted rounded animate-pulse"})]})]}),J=r=>{const s={"Alert Created":"warning","Alert Acknowledged":"warning","Alert Resolved":"success","Container Started":"success","Container Stopped":"error","Container Restarted":"warning","Container Created":"info","Health Check":"success","Daemon Event":"info","Image Pulled":"info","Metrics Collected":"info"}[r]||"neutral",o=s==="neutral"?h("neutral",100):h(s,50),c=s==="neutral"?h("neutral",700):h(s,600),u=s==="neutral"?A.border.light:h(s,200);return{backgroundColor:o,color:c,borderColor:u,padding:"0.15rem 0.5rem"}},K=({filteredEvents:r})=>{const{isDarkMode:l}=L();return e.jsx(g,{children:e.jsx(v,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs($,{children:[e.jsx(q,{children:e.jsxs(y,{children:[e.jsx(p,{children:"Timestamp"}),e.jsx(p,{children:"Event Type"}),e.jsx(p,{children:"Container"}),e.jsx(p,{children:"Message"}),e.jsx(p,{children:"Details"})]})}),e.jsx(z,{children:r.length===0?e.jsx(y,{children:e.jsx(f,{colSpan:5,className:"text-center py-8",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(k,{className:"h-8 w-8 text-muted-foreground"}),e.jsx("p",{className:"text-muted-foreground",children:"No event logs found"})]})})}):r.map(s=>e.jsxs(y,{className:"hover:bg-muted/50",children:[e.jsx(f,{className:"text-muted-foreground whitespace-nowrap",children:new Date(s.timestamp).toLocaleString()}),e.jsx(f,{children:e.jsx(T,{variant:"outline",style:J(s.type),children:s.type})}),e.jsx(f,{children:s.container?e.jsx(T,{variant:"outline",className:"text-xs",style:{color:l?h("neutral",300):h("neutral",700)},children:s.container}):e.jsx("span",{className:"text-sm text-muted-foreground",children:"—"})}),e.jsx(f,{className:"text-foreground",children:s.message}),e.jsx(f,{className:"text-sm text-muted-foreground",children:s.details||"—"})]},s.id))})]})})})})},ne=()=>{const[r,l]=t.useState(""),[s,o]=t.useState("all"),[c,u]=t.useState(!1),{events:n,loading:i,error:N,refetch:w}=P(c?5e3:void 0,s!=="all"?s:void 0,void 0,100),d=t.useMemo(()=>Array.from(new Set(n.map(a=>a.type))),[n]),x=t.useMemo(()=>n.filter(a=>a.message.toLowerCase().includes(r.toLowerCase())||a.type.toLowerCase().includes(r.toLowerCase())||a.container&&a.container.toLowerCase().includes(r.toLowerCase())),[n,r]),m=async()=>{try{await w(),S.success("Event logs refreshed")}catch{S.error("Failed to refresh events")}};return i&&n.length===0?e.jsx(G,{}):N&&n.length===0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-foreground mb-1",children:"Event Logs"}),e.jsx("p",{className:"text-muted-foreground",children:"System and container event logs"})]})}),e.jsx(g,{children:e.jsx(v,{className:"p-8",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-destructive mb-4",children:["Error loading events: ",N]}),e.jsx(C,{onClick:m,children:"Retry"})]})})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-foreground mb-1",children:"Event Logs"}),e.jsx("p",{className:"text-muted-foreground",children:"System and container event logs"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(C,{variant:c?"default":"outline",size:"sm",onClick:()=>u(!c),children:[e.jsx(R,{className:`h-4 w-4 mr-2 ${c?"animate-spin":""}`}),c?"Auto Refresh On":"Auto Refresh Off"]})})]}),e.jsx(U,{searchTerm:r,onSearchChange:l,typeFilter:s,onTypeFilterChange:o,uniqueTypes:d,onRefresh:m,isLoading:i}),e.jsx(K,{filteredEvents:x}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-muted-foreground",children:[e.jsxs("p",{children:["Showing ",x.length," of ",n.length," events"]}),e.jsxs("p",{children:["Last updated: ",new Date().toLocaleTimeString()]})]})]})};export{ne as EventLogs};
