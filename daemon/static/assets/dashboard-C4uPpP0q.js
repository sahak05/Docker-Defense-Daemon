import{t as i}from"./index-D1sIiVvK.js";const g="http://localhost:8080/api";async function n(t,e){try{const r=await fetch(`${g}${t}`,{headers:{"Content-Type":"application/json"},...e});if(!r.ok){const o=await r.text(),s=`Error ${r.status}: ${o||r.statusText}`;throw i.error(s),new Error(s)}return await r.json()}catch(r){throw r instanceof TypeError?i.error("Network error — please check your connection and try again."):r.message.startsWith("Error")||i.error("An unexpected error occurred. Please try again."),console.error("API fetch failed:",r),r}}async function v(){return n("/dashboard")}async function S(){return n("/daemon-status")}async function _(){try{const t=await n("/alerts");return h(t)}catch(t){throw console.error("Error fetching alerts:",t),t}}async function A(){try{const t=await n("/containers/list");return y(t)}catch(t){throw console.error("Error fetching containers:",t),t}}async function C(){try{return await n("/containers/images/list")}catch(t){throw console.error("Error fetching container images:",t),t}}async function $(t,e,r){try{const o=new URLSearchParams;t&&o.append("limit",t.toString()),e&&o.append("type",e);const s=o.toString(),p=s?`/events?${s}`:"/events",d=await n(p);return f(d)}catch(o){throw console.error("Error fetching events:",o),o}}function y(t){return Array.isArray(t)?t.map(e=>({id:e.id||"unknown",name:e.name||"unnamed",image:e.image||"unknown",status:e.status||"unknown",uptime:e.uptime||"N/A",cpu:Number(e.cpu)||0,memory:Number(e.memory)||0,memory_limit:Number(e.memory_limit)||0,created:e.created||"",last_event:e.last_event||"unknown",full_id:e.full_id||e.id||""})):[]}function h(t){return t.map(e=>{if(e.source==="falco")return{id:e.id||a(),timestamp:e.timestamp||new Date().toISOString(),type:e.rule||"Unknown Rule",severity:c(e.severity),container:e.container?.name||"unknown",status:e.status||"new",description:e.summary||"No description available",details:l(e),suggestedAction:e.suggested_action||m(e.severity)};if(e.risks&&e.metadata){const r=e.risks.reduce((o,s)=>u(s.severity)>u(o.severity)?s:o);return{id:e.id||a(),timestamp:e.log_time||new Date().toISOString(),type:r.rule||"Container Risk Detected",severity:c(r.severity),container:e.metadata.id?.substring(0,12)||"unknown",status:e.status||"new",description:r.description||"Container has detected risks",details:w(e.risks),suggestedAction:m(r.severity)}}return{id:e.id||a(),timestamp:e.timestamp||e.log_time||new Date().toISOString(),type:e.type||"Alert",severity:"info",container:e.container||"unknown",status:e.status||"new",description:e.description||JSON.stringify(e).substring(0,100),details:"Unable to parse alert details",suggestedAction:"Review alert details for more information"}})}function f(t){return Array.isArray(t)?t.map(e=>({id:e.id||a(),timestamp:e.timestamp||new Date().toISOString(),type:e.type||"Unknown Event",message:e.message||"No message provided",container:e.container||void 0,details:e.details||void 0})):[]}function c(t){const e=(t||"").toLowerCase();return e==="critical"||e==="high"?"critical":e==="warning"||e==="medium"?"warning":"info"}function u(t){const e=(t||"").toLowerCase();return e==="critical"||e==="high"?3:e==="warning"||e==="medium"?2:1}function l(t){const e=[];return t.container?.name&&e.push(`Container: ${t.container.name}`),t.process&&e.push(`Process: ${t.process}`),t.user&&e.push(`User: ${t.user}`),t.container?.image&&e.push(`Image: ${t.container.image}`),e.join(`
`)||t.raw?.output||"No additional details"}function w(t){return!t||t.length===0?"No risks detected":t.map(e=>`• ${e.rule}: ${e.description}`).join(`
`)}function m(t){const e=(t||"").toLowerCase();return e==="critical"||e==="high"?"Investigate immediately and take corrective action":e==="warning"||e==="medium"?"Review and monitor for further issues":"Log for audit and continue monitoring"}function a(){return`alert-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}async function E(t){try{return await n(`/alerts/${t}/acknowledge`,{method:"POST",headers:{"Content-Type":"application/json"}})}catch(e){throw console.error(`Error acknowledging alert ${t}:`,e),e}}async function T(t){try{return await n(`/alerts/${t}/resolve`,{method:"POST",headers:{"Content-Type":"application/json"}})}catch(e){throw console.error(`Error resolving alert ${t}:`,e),e}}async function b(t){try{return await n(`/containers/${t}/stop`,{method:"POST",headers:{"Content-Type":"application/json"}})}catch(e){throw console.error(`Error stopping container ${t}:`,e),e}}async function N(t){try{return await n(`/containers/${t}/start`,{method:"POST",headers:{"Content-Type":"application/json"}})}catch(e){throw console.error(`Error starting container ${t}:`,e),e}}async function D(t){try{return await n(`/containers/${t}/restart`,{method:"POST",headers:{"Content-Type":"application/json"}})}catch(e){throw console.error(`Error restarting container ${t}:`,e),e}}async function j(t){try{return await n(`/approvals/${encodeURIComponent(t)}/approve`,{method:"POST",headers:{"Content-Type":"application/json"}})}catch(e){throw console.error(`Error approving image ${t}:`,e),e}}async function O(t){try{return await n(`/approvals/${encodeURIComponent(t)}/deny`,{method:"POST",headers:{"Content-Type":"application/json"}})}catch(e){throw console.error(`Error denying image ${t}:`,e),e}}async function P(){try{const t=await n("/system-status",{method:"GET",headers:{"Content-Type":"application/json"}});return{hostInformation:{operatingSystem:t.host_information?.operating_system||"N/A",kernelRelease:t.host_information?.kernel_release||"N/A",architecture:t.host_information?.architecture||"N/A",dockerVersion:t.host_information?.docker_version||"N/A",apiVersion:t.host_information?.api_version||"N/A"},systemResources:{cpu:{cores:t.system_resources?.cpu?.cores||"N/A",usagePercent:t.system_resources?.cpu?.usage_percent||0},memory:{totalGb:t.system_resources?.memory?.total_gb||"N/A",usedGb:t.system_resources?.memory?.used_gb||"N/A",usagePercent:t.system_resources?.memory?.usage_percent||0},disk:{totalGb:t.system_resources?.disk?.total_gb||"N/A",usedGb:t.system_resources?.disk?.used_gb||"N/A",usagePercent:t.system_resources?.disk?.usage_percent||0}},timestamp:t.timestamp||new Date().toISOString()}}catch(t){throw console.error("Error fetching system status:",t),t}}async function I(){try{const t=await n("/docker-daemon",{method:"GET",headers:{"Content-Type":"application/json"}});return{images:{total:t.images?.total||0,sizeGb:t.images?.size_gb||0},volumes:{total:t.volumes?.total||0},networks:{total:t.networks?.total||0,bridge:t.networks?.bridge||0,custom:t.networks?.custom||0},timestamp:t.timestamp||new Date().toISOString()}}catch(t){throw console.error("Error fetching Docker daemon info:",t),t}}async function R(){try{return await n("/daemon/restart",{method:"POST",headers:{"Content-Type":"application/json"}})}catch(t){throw console.error("Error restarting daemon:",t),t}}async function U(){try{return await n("/daemon/stop",{method:"POST",headers:{"Content-Type":"application/json"}})}catch(t){throw console.error("Error stopping daemon:",t),t}}export{A as a,b,_ as c,T as d,E as e,I as f,v as g,P as h,S as i,R as j,U as k,$ as l,C as m,j as n,O as o,D as r,N as s};
