import{r as o,j as e,b as r,g as S,u as M,L as P,t as k}from"./index-D1sIiVvK.js";import{C as v,a as N,B as y}from"./button-Cll9udIQ.js";import{c as Q,d as Y,e as Z}from"./dashboard-C4uPpP0q.js";import{e as _}from"./dataValidation-C8LmOa9k.js";import{C as D}from"./circle-x-Dpf6tdOW.js";import{T as R}from"./triangle-alert-B6RBxBYZ.js";import{C as z}from"./clock-DRzb4TT9.js";import{I as $}from"./index-CUShK7au.js";import{S as ee,a as I,b as E,c as B,d as W,e as j,T as se,f as re,g as A,h as p,i as te,j as g}from"./table-DtcC-p1F.js";import{D as le,E as ae}from"./eye-Ba5NoheN.js";import{B as C}from"./badge-C2p9_LPb.js";import{D as ne,a as oe,b as ce,c as ie,d as de,e as ue}from"./dialog-4R3n7hRm.js";import{C as T}from"./circle-check-BpUi3HHm.js";import"./index-TCh1iRsV.js";import"./Combination-6KfI5B73.js";import"./check-Bz-vlGHe.js";const xe=s=>{const[a,i]=o.useState([]),[d,l]=o.useState(!0),[t,m]=o.useState(null),c=o.useRef(!0),h=o.useRef(!1),f=o.useRef(null),w=o.useCallback(async()=>{if(!h.current){h.current=!0;try{if(!c.current)return;l(!0);const u=await Q();if(!c.current)return;const x=_(u||[]);i(x),m(null)}catch(u){if(!c.current)return;const x=u instanceof Error?u.message:"Unknown error";console.error("Alerts fetch failed:",x),m(x)}finally{c.current&&(l(!1),h.current=!1)}}},[]);return o.useEffect(()=>(c.current=!0,w(),()=>{c.current=!1,f.current&&clearInterval(f.current)}),[w]),o.useEffect(()=>{},[s,w]),{alerts:a,loading:d,error:t,refetch:w}},me=({alerts:s})=>{const a=s.filter(l=>l.severity==="critical").length,i=s.filter(l=>l.severity==="warning").length,d=s.filter(l=>l.status==="new").length;return e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsx(v,{children:e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Critical"}),e.jsx("p",{className:"text-foreground",children:a})]}),e.jsx("div",{style:{backgroundColor:r.error[50]},className:"h-10 w-10 rounded-lg flex items-center justify-center",children:e.jsx(D,{className:"h-5 w-5",style:{color:S("neutral",600)}})})]})})}),e.jsx(v,{children:e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Warning"}),e.jsx("p",{className:"text-foreground",children:i})]}),e.jsx("div",{style:{backgroundColor:r.warning[50]},className:"h-10 w-10 rounded-lg flex items-center justify-center",children:e.jsx(R,{className:"h-5 w-5",style:{color:S("neutral",600)}})})]})})}),e.jsx(v,{children:e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"New Alerts"}),e.jsx("p",{className:"text-foreground",children:d})]}),e.jsx("div",{style:{backgroundColor:r.info[50]},className:"h-10 w-10 rounded-lg flex items-center justify-center",children:e.jsx(z,{className:"h-5 w-5",style:{color:S("neutral",600)}})})]})})})]})},he=({searchTerm:s,onSearchChange:a,severityFilter:i,onSeverityChange:d,statusFilter:l,onStatusChange:t})=>e.jsx(v,{children:e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ee,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx($,{placeholder:"Search alerts by type, container, or description...",value:s,onChange:m=>a(m.target.value),className:"pl-9"})]}),e.jsxs(I,{value:i,onValueChange:d,children:[e.jsx(E,{className:"w-full sm:w-40",children:e.jsx(B,{placeholder:"Severity"})}),e.jsxs(W,{children:[e.jsx(j,{value:"all",children:"All Severity"}),e.jsx(j,{value:"critical",children:"Critical"}),e.jsx(j,{value:"warning",children:"Warning"}),e.jsx(j,{value:"info",children:"Info"})]})]}),e.jsxs(I,{value:l,onValueChange:t,children:[e.jsx(E,{className:"w-full sm:w-40",children:e.jsx(B,{placeholder:"Status"})}),e.jsxs(W,{children:[e.jsx(j,{value:"all",children:"All Status"}),e.jsx(j,{value:"new",children:"New"}),e.jsx(j,{value:"acknowledged",children:"Acknowledged"}),e.jsx(j,{value:"resolved",children:"Resolved"})]})]}),e.jsx(y,{variant:"outline",size:"icon",tokenStyles:!0,children:e.jsx(le,{className:"h-4 w-4"})})]})})});function H(s,a){return s?s.length>a?s.slice(0,a)+"...":s:""}const je=({alerts:s,onSelectAlert:a,getSeverityStyle:i,getAlertStatusStyle:d,getStatusIcon:l})=>e.jsx(v,{children:e.jsx(N,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(se,{children:[e.jsx(re,{children:e.jsxs(A,{children:[e.jsx(p,{style:{maxWidth:"200px"},children:"Alert Type"}),e.jsx(p,{children:"Container"}),e.jsx(p,{children:"Severity"}),e.jsx(p,{children:"Status"}),e.jsx(p,{children:"Timestamp"}),e.jsx(p,{className:"text-right",children:"Actions"})]})}),e.jsx(te,{children:s.length===0?e.jsx(A,{children:e.jsx(g,{colSpan:6,className:"text-center py-8",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(R,{className:"h-8 w-8 text-muted-foreground"}),e.jsx("p",{className:"text-muted-foreground",children:"No alerts found"})]})})}):s.map(t=>e.jsxs(A,{className:"hover:bg-muted/50",children:[e.jsx(g,{style:{maxWidth:"150px"},children:e.jsxs("div",{className:"truncate",children:[e.jsx("p",{className:"text-foreground truncate font-medium",title:t.type,children:t.type}),e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-1",children:H(t.description,100)})]})}),e.jsx(g,{children:e.jsx(C,{variant:"outline",className:"text-xs",tokenStyles:!0,children:t.container})}),e.jsx(g,{children:e.jsx(C,{tokenStyles:!0,variant:"outline",style:{backgroundColor:i(t.severity).backgroundColor,color:i(t.severity).color,borderColor:i(t.severity).borderColor},children:t.severity})}),e.jsx(g,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[l(t.status),e.jsx(C,{variant:"outline",style:{...d(t.status),padding:"0.15rem 0.5rem"},children:t.status})]})}),e.jsx(g,{className:"text-muted-foreground text-sm",children:new Date(t.timestamp).toLocaleString()}),e.jsx(g,{className:"text-right",children:e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>a(t),children:e.jsx(ae,{className:"h-4 w-4"})})})]},t.id))})]})})})}),fe=({alert:s,open:a,onOpenChange:i,onAcknowledge:d,onResolve:l,getSeverityStyle:t,getAlertStatusStyle:m,isLoading:c=!1})=>{const{isDarkMode:h}=M();return s?e.jsx(ne,{open:a,onOpenChange:i,children:e.jsxs(oe,{className:"max-w-2xl overflow-y-auto",children:[e.jsxs(ce,{children:[e.jsx(ie,{className:"wrap-break-word",children:s.type}),e.jsxs(de,{children:["Alert ID: ",s.id]})]}),e.jsxs("div",{className:"space-y-4 overflow-y-auto max-h-[60vh]",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx(C,{variant:"outline",style:{backgroundColor:t(s.severity).backgroundColor,color:t(s.severity).color,borderColor:t(s.severity).borderColor},children:s.severity}),e.jsx(C,{variant:"outline",style:{...m(s.status)},children:s.status}),e.jsx(C,{variant:"outline",children:s.container})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Description"}),e.jsx("p",{className:"text-foreground wrap-break-word overflow-wrap-anywhere whitespace-pre-wrap w-full",style:{wordBreak:"break-word",overflowWrap:"anywhere",whiteSpace:"pre-wrap",maxWidth:"100%"},children:H(s.description,500)})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Details"}),e.jsx("p",{className:"text-foreground wrap-break-word w-full overflow-wrap",children:s.details})]}),s.suggestedAction&&e.jsxs("div",{style:{backgroundColor:h?r.neutral[100]:r.info[50],borderColor:h?r.neutral[700]:r.info[200]},className:"rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Suggested Action"}),e.jsx("p",{className:"text-sm text-foreground wrap-break-word w-full",style:{color:S("neutral",600)},children:s.suggestedAction})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Timestamp"}),e.jsx("p",{className:"text-foreground",children:new Date(s.timestamp).toLocaleString()})]})]}),e.jsx(ue,{children:e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto flex-wrap",children:[s.status==="new"&&e.jsxs(y,{variant:"outline",onClick:d,disabled:c,children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"Acknowledge"]}),s.status!=="resolved"&&e.jsxs(y,{onClick:l,disabled:c,children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"Mark as Resolved"]})]})})]})}):null},Ie=()=>{const{isDarkMode:s}=M(),{alerts:a,loading:i,error:d,refetch:l}=xe(),[t,m]=o.useState(""),[c,h]=o.useState("all"),[f,w]=o.useState("all"),[u,x]=o.useState(null),[V,b]=o.useState(!1),U=o.useMemo(()=>a.filter(n=>{const G=n.type.toLowerCase().includes(t.toLowerCase())||n.container.toLowerCase().includes(t.toLowerCase())||n.description.toLowerCase().includes(t.toLowerCase()),J=c==="all"||n.severity===c,K=f==="all"||n.status===f;return G&&J&&K}),[a,t,c,f]),L=n=>{switch(n){case"critical":return{backgroundColor:r.error[100],color:r.error[700],borderColor:r.error[200]};case"warning":return{backgroundColor:r.warning[100],color:r.warning[700],borderColor:r.warning[200]};case"info":return{backgroundColor:r.info[100],color:r.info[700],borderColor:r.info[200]};default:return{backgroundColor:s?r.neutral[800]:r.neutral[100],color:s?r.neutral[100]:r.neutral[700],borderColor:s?r.neutral[700]:r.neutral[200]}}},q=n=>{switch(n){case"new":return e.jsx(z,{className:"h-4 w-4"});case"acknowledged":return e.jsx(R,{className:"h-4 w-4"});case"resolved":return e.jsx(T,{className:"h-4 w-4"});default:return e.jsx(D,{className:"h-4 w-4"})}},F=n=>{switch(n){case"new":return{backgroundColor:s?r.error[700]:r.error[100],color:s?r.error[50]:r.error[700],borderColor:s?r.error[600]:r.error[200]};case"acknowledged":return{backgroundColor:s?r.warning[700]:r.warning[100],color:s?r.warning[50]:r.warning[700],borderColor:s?r.warning[600]:r.warning[200]};case"resolved":return{backgroundColor:s?r.success[700]:r.success[100],color:s?r.success[50]:r.success[700],borderColor:s?r.success[600]:r.success[200]};default:return{backgroundColor:s?r.neutral[800]:r.neutral[100],color:s?r.neutral[100]:r.neutral[700],borderColor:s?r.neutral[700]:r.neutral[200]}}},O=async()=>{if(u){b(!0);try{await Z(u.id),k.success("Alert acknowledged successfully"),x(null),l()}catch(n){console.error("Failed to acknowledge alert:",n),k.error("Failed to acknowledge alert")}finally{b(!1)}}},X=async()=>{if(u){b(!0);try{await Y(u.id),k.success("Alert marked as resolved"),x(null),l()}catch(n){console.error("Failed to resolve alert:",n),k.error("Failed to resolve alert")}finally{b(!1)}}};return e.jsxs("div",{className:"space-y-6 text-foreground",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-foreground mb-1",children:"Alerts Center"}),e.jsx("p",{className:"text-muted-foreground",children:"Review and manage security and anomaly alerts"})]}),i&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(P,{className:"h-4 w-4 animate-spin"}),"Loading..."]})]}),d&&e.jsx(v,{className:"border-red-500",children:e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(D,{className:"h-5 w-5 text-text-error shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-text-error",children:"Error loading alerts"}),e.jsx("p",{className:"text-sm text-text-error",children:d}),e.jsx(y,{size:"sm",variant:"outline",onClick:()=>l(),className:"mt-2",children:"Try Again"})]})]})})}),e.jsx(me,{alerts:a}),e.jsx(he,{searchTerm:t,onSearchChange:m,severityFilter:c,onSeverityChange:h,statusFilter:f,onStatusChange:w}),e.jsx(je,{alerts:U,onSelectAlert:x,getSeverityStyle:L,getAlertStatusStyle:F,getStatusIcon:q}),e.jsx(fe,{alert:u,open:!!u,onOpenChange:()=>x(null),onAcknowledge:O,onResolve:X,getSeverityStyle:L,getAlertStatusStyle:F,isLoading:V})]})};export{Ie as AlertsCenter};
