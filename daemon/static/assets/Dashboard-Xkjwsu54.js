import{c as N,r as l,u as z,a as F,j as e,g as d,b as _,d as p,A as f,S as G,R as x,e as k}from"./index-D1sIiVvK.js";import{g as U}from"./dashboard-C4uPpP0q.js";import{e as j}from"./dataValidation-C8LmOa9k.js";import{C as S}from"./circle-check-BpUi3HHm.js";import{C}from"./circle-x-Dpf6tdOW.js";import{T as q}from"./triangle-alert-B6RBxBYZ.js";import{S as V}from"./server-D90aBjTF.js";import{C as P}from"./clock-DRzb4TT9.js";const O=[["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]],Y=N("box",O);const J=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"10",x2:"10",y1:"15",y2:"9",key:"c1nkhi"}],["line",{x1:"14",x2:"14",y1:"15",y2:"9",key:"h65svq"}]],K=N("circle-pause",J);const X=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],Z=N("trending-up",X),v={DASHBOARD:"/",SETTINGS:"/settings",EVENT_LOGS:"/event-logs",ALERTS:"/alerts",CONTAINERS:"/containers",SYSTEM_STATUS:"/system-status"},Q="_dashboard_kyqga_5",W="_header_kyqga_21",ee="_title_kyqga_35",se="_subtitle_kyqga_49",te="_headerActions_kyqga_61",ae="_daemonStatus_kyqga_73",re="_statusDot_kyqga_109",ne="_pulse_kyqga_1",ie="_running_kyqga_123",ce="_stopped_kyqga_131",oe="_error_kyqga_139",le="_summaryGrid_kyqga_169",de="_card_kyqga_185",me="_cardHeader_kyqga_231",ue="_cardIcon_kyqga_245",he="_cardBody_kyqga_281",ye="_mainStat_kyqga_293",_e="_subStats_kyqga_307",ge="_subStat_kyqga_307",ve="_severityDot_kyqga_343",xe="_contentGrid_kyqga_357",ke="_section_kyqga_373",je="_sectionHeader_kyqga_397",pe="_linkButton_kyqga_423",Ne="_alertsList_kyqga_455",Se="_alertItem_kyqga_467",be="_alertSeverity_kyqga_513",fe="_alertContent_kyqga_531",Ce="_alertMeta_kyqga_575",qe="_timestamp_kyqga_589",De="_containerTag_kyqga_599",Te="_alertStatus_kyqga_631",Ae="_badge_kyqga_641",Ie="_acknowledged_kyqga_667",Me="_resolved_kyqga_677",we="_riskCount_kyqga_687",Ee="_trivyAlert_kyqga_703",Le="_critical_kyqga_719",He="_high_kyqga_729",Be="_medium_kyqga_739",Re="_low_kyqga_749",$e="_containersList_kyqga_761",ze="_containerItem_kyqga_773",Fe="_containerHeader_kyqga_811",Ge="_containerInfo_kyqga_825",Ue="_containerMetrics_kyqga_859",Ve="_metric_kyqga_871",Pe="_metricLabel_kyqga_885",Oe="_progressBar_kyqga_909",Ye="_progressFill_kyqga_931",Je="_metricValue_kyqga_943",Ke="_activitySection_kyqga_957",Xe="_activityTimeline_kyqga_981",Ze="_activityItem_kyqga_993",Qe="_activityDot_kyqga_1007",We="_activityLine_kyqga_1039",es="_activityContent_kyqga_1065",ss="_activityTime_kyqga_981",ts="_emptyState_kyqga_1097",as="_loadingContainer_kyqga_1129",rs="_spinner_kyqga_1147",ns="_spin_kyqga_1147",is="_errorContainer_kyqga_1189",cs="_slideIn_kyqga_1",t={dashboard:Q,header:W,title:ee,subtitle:se,headerActions:te,daemonStatus:ae,statusDot:re,pulse:ne,running:ie,stopped:ce,error:oe,summaryGrid:le,card:de,cardHeader:me,cardIcon:ue,cardBody:he,mainStat:ye,subStats:_e,subStat:ge,severityDot:ve,contentGrid:xe,section:ke,sectionHeader:je,linkButton:pe,alertsList:Ne,alertItem:Se,alertSeverity:be,alertContent:fe,alertMeta:Ce,timestamp:qe,containerTag:De,alertStatus:Te,badge:Ae,new:"_new_kyqga_657",acknowledged:Ie,resolved:Me,riskCount:we,trivyAlert:Ee,critical:Le,high:He,medium:Be,low:Re,containersList:$e,containerItem:ze,containerHeader:Fe,containerInfo:Ge,containerMetrics:Ue,metric:Ve,metricLabel:Pe,progressBar:Oe,progressFill:Ye,metricValue:Je,activitySection:Ke,activityTimeline:Xe,activityItem:Ze,activityDot:Qe,activityLine:We,activityContent:es,activityTime:ss,emptyState:ts,loadingContainer:as,spinner:rs,spin:ns,errorContainer:is,slideIn:cs},os=()=>{const[s,a]=l.useState(null),[n,r]=l.useState(!0),[i,c]=l.useState(null),o=l.useRef(!0),u=l.useRef(!1),y=l.useCallback(async()=>{if(!u.current){u.current=!0;try{if(!o.current)return;r(!0);const m=await U();if(!o.current)return;if(!m?.success||!m?.data)throw new Error(m?.error||"Failed to fetch dashboard data");const g={...m.data,recentAlerts:j(m.data.recentAlerts||[]),topContainers:j(m.data.topContainers||[]),recentActivity:j(m.data.recentActivity||[])};a(g),c(null)}catch(m){if(!o.current)return;const g=m instanceof Error?m.message:"Unknown error";console.error("Dashboard fetch failed:",g),c(g)}finally{o.current&&(r(!1),u.current=!1)}}},[]);return l.useEffect(()=>(o.current=!0,y(),()=>{o.current=!1}),[y]),{dashboardData:s,loading:n,error:i}},ls=s=>{const a=z();return{isDarkMode:l.useMemo(()=>typeof s=="boolean"?s:a.isDarkMode,[s,a.isDarkMode]),toggleTheme:a.toggle}},ds=()=>{const s=F();return{toDashboard:()=>s(v.DASHBOARD),toContainers:()=>s(v.CONTAINERS),toAlerts:()=>s(v.ALERTS),toEventLogs:()=>s(v.EVENT_LOGS),toSystemStatus:()=>s(v.SYSTEM_STATUS),toSettings:()=>s(v.SETTINGS),navigateTo:(a,n)=>s(a,{state:n}),goBack:()=>s(-1),goForward:()=>s(1)}},D=l.createContext(void 0),ms=({children:s,dashboardData:a,loading:n,error:r,isDarkMode:i,onToggleDarkMode:c,onNavigate:o,memoryPercentage:u})=>{const y={dashboardData:a,loading:n,error:r,isDarkMode:i,onToggleDarkMode:c,onNavigate:o,memoryPercentage:u};return e.jsx(D.Provider,{value:y,children:s})},h=()=>{const s=l.useContext(D);if(s===void 0)throw new Error("useDashboardContext must be used within DashboardProvider");return s},T=()=>{const{dashboardData:s}=h();if(!s)return null;const{daemonStatus:a}=s.summary;return e.jsxs("header",{className:t.header,children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-foreground mb-1",children:"Dashboard"}),e.jsx("p",{className:"text-muted-foreground",children:"Docker Defense Daemon Overview"})]}),e.jsx("div",{className:t.headerActions,children:e.jsxs("div",{className:t.daemonStatus,children:[e.jsx("div",{className:`${t.statusDot} ${t[a.status]}`}),e.jsxs("span",{children:["Daemon ",a.status]})]})})]})};T.displayName="DashboardHeader";const us=s=>{if(!s||isNaN(s))return"0m";const a=Math.floor(s/86400),n=Math.floor(s%86400/3600),r=Math.floor(s%3600/60);return a>0?`${a}d ${n}h`:n>0?`${n}h ${r}m`:`${r}m`},A=s=>{if(!s)return"Unknown time";const a=new Date(s);if(isNaN(a.getTime()))return"Invalid time";const r=Math.floor((new Date().getTime()-a.getTime())/1e3);return r<0||r<60?"Just now":r<3600?`${Math.floor(r/60)}m ago`:r<86400?`${Math.floor(r/3600)}h ago`:`${Math.floor(r/86400)}d ago`},I=()=>{const{isDarkMode:s,dashboardData:a,memoryPercentage:n}=h();if(!a)return null;const{summary:r}=a;return e.jsxs("div",{className:t.summaryGrid,children:[e.jsxs("div",{className:t.card,children:[e.jsxs("div",{className:t.cardHeader,children:[e.jsx("div",{className:t.cardIcon,style:{backgroundColor:d("primary","100",s)},children:e.jsx(Y,{size:24,color:d("primary","600",s)})}),e.jsx("h3",{children:"Containers"})]}),e.jsxs("div",{className:t.cardBody,children:[e.jsx("div",{className:t.mainStat,children:r.containers.total}),e.jsxs("div",{className:t.subStats,children:[e.jsxs("div",{className:t.subStat,children:[e.jsx(S,{size:16,color:_.success[500]}),e.jsxs("span",{children:[r.containers.running," running"]})]}),e.jsxs("div",{className:t.subStat,children:[e.jsx(C,{size:16,color:_.error[500]}),e.jsxs("span",{children:[r.containers.stopped," stopped"]})]})]})]})]}),e.jsxs("div",{className:t.card,children:[e.jsxs("div",{className:t.cardHeader,children:[e.jsx("div",{className:t.cardIcon,style:{backgroundColor:d("warning","100",s)},children:e.jsx(q,{size:24,color:d("warning","600",s)})}),e.jsx("h3",{children:"Alerts"})]}),e.jsxs("div",{className:t.cardBody,children:[e.jsx("div",{className:t.mainStat,children:r.alerts.unresolved}),e.jsxs("div",{className:t.subStats,children:[e.jsxs("div",{className:t.subStat,children:[e.jsx("div",{className:t.severityDot,style:{backgroundColor:p("critical")}}),e.jsxs("span",{children:[r.alerts.critical," critical"]})]}),e.jsxs("div",{className:t.subStat,children:[e.jsx("div",{className:t.severityDot,style:{backgroundColor:p("high")}}),e.jsxs("span",{children:[r.alerts.high," high"]})]})]})]})]}),e.jsxs("div",{className:t.card,children:[e.jsxs("div",{className:t.cardHeader,children:[e.jsx("div",{className:t.cardIcon,style:{backgroundColor:d("success","100",s)},children:e.jsx(f,{size:24,color:d("success","600",s)})}),e.jsx("h3",{children:"System Health"})]}),e.jsxs("div",{className:t.cardBody,children:[e.jsxs("div",{className:t.mainStat,children:[r.systemMetrics.cpu.usage.toFixed(1),"%"]}),e.jsxs("div",{className:t.subStats,children:[e.jsxs("div",{className:t.subStat,children:[e.jsx(V,{size:16,color:d("neutral","500",s)}),e.jsx("span",{children:"CPU Usage"})]}),e.jsxs("div",{className:t.subStat,children:[e.jsx(Z,{size:16,color:d("info","500",s)}),e.jsxs("span",{children:[n,"% Memory"]})]})]})]})]}),e.jsxs("div",{className:t.card,children:[e.jsxs("div",{className:t.cardHeader,children:[e.jsx("div",{className:t.cardIcon,style:{backgroundColor:d("info","100",s)},children:e.jsx(P,{size:24,color:d("info","600",s)})}),e.jsx("h3",{children:"Uptime"})]}),e.jsxs("div",{className:t.cardBody,children:[e.jsx("div",{className:t.mainStat,children:us(r.daemonStatus.uptime)}),e.jsx("div",{className:t.subStats,children:e.jsxs("div",{className:t.subStat,children:[e.jsx(G,{size:16,color:_.success[500]}),e.jsxs("span",{children:["v",r.daemonStatus.version]})]})})]})]})]})};I.displayName="SummaryCards";const hs=s=>({running:x.createElement(S,{size:20,color:k("running",s)}),stopped:x.createElement(C,{size:20,color:k("stopped",s)}),paused:x.createElement(K,{size:20,color:k("paused",s)})}),ys=(s,a,n)=>a[s]||x.createElement(f,{size:20,color:d("neutral","500",n)}),_s={critical:4,high:3,medium:2,low:1},b=s=>_s[s]??0,M=x.memo(({alert:s,onClick:a})=>{const n=l.useMemo(()=>!s?.risks||s.risks.length===0?{description:"No risks detected",severity:"low"}:s.risks.reduce((r,i)=>{const c=b(i.severity),o=b(r.severity);return c>o?i:r},s.risks[0]),[s.risks]);return e.jsxs("div",{className:t.alertItem,role:"button",tabIndex:0,onClick:()=>a(s.id),onKeyDown:r=>{(r.key==="Enter"||r.key===" ")&&a(s.id)},style:{cursor:"pointer"},children:[e.jsx("div",{className:t.alertSeverity,style:{backgroundColor:p(n.severity)}}),e.jsxs("div",{className:t.alertContent,children:[e.jsx("h4",{children:`${s.action?.toUpperCase()??"ALERT"} - ${s.image??"unknown"}`}),e.jsx("p",{children:n.description}),e.jsxs("div",{className:t.alertMeta,children:[e.jsx("span",{className:t.timestamp,children:A(s.log_time)}),e.jsxs("span",{className:t.riskCount,children:[s.risks?.length??0," risks detected"]}),s.trivy?.high_or_critical?e.jsxs("span",{className:t.trivyAlert,children:[s.trivy.high_or_critical," critical vulnerabilities"]}):null]})]}),e.jsx("div",{className:t.alertStatus,children:e.jsx("span",{className:`${t.badge} ${t[n.severity]}`,children:n.severity})})]})});M.displayName="AlertItem";const w=()=>{const{isDarkMode:s,dashboardData:a,onNavigate:n}=h();if(!a)return null;const{recentAlerts:r}=a,i=c=>{n("alerts",c)};return e.jsxs("div",{className:t.section,children:[e.jsxs("div",{className:t.sectionHeader,children:[e.jsx("h2",{children:"Recent Alerts"}),e.jsx("button",{className:t.linkButton,onClick:()=>n("alerts"),children:"View All"})]}),e.jsx("div",{className:t.alertsList,children:r.length===0?e.jsxs("div",{className:t.emptyState,children:[e.jsx(S,{size:48,color:d("success","500",s)}),e.jsx("p",{children:"No recent alerts"})]}):r.slice(0,5).map(c=>{const o=c;return e.jsx(M,{alert:o,onClick:i},o.id)})})]})};w.displayName="AlertsSection";const E=x.memo(({container:s,onClick:a})=>{const{isDarkMode:n}=h(),r=l.useMemo(()=>hs(n),[n]),i=l.useMemo(()=>ys(s.status,r,n),[s.status,r,n]);return e.jsxs("div",{className:t.containerItem,role:"button",tabIndex:0,onClick:()=>a(s.id),onKeyDown:c=>{(c.key==="Enter"||c.key===" ")&&a(s.id)},style:{cursor:"pointer"},children:[e.jsxs("div",{className:t.containerHeader,children:[i,e.jsxs("div",{className:t.containerInfo,children:[e.jsx("h4",{children:s.name}),e.jsx("p",{children:s.image})]})]}),e.jsxs("div",{className:t.containerMetrics,children:[e.jsxs("div",{className:t.metric,children:[e.jsx("span",{className:t.metricLabel,children:"CPU"}),e.jsx("div",{className:t.progressBar,children:e.jsx("div",{className:t.progressFill,style:{width:`${s.cpu}%`,backgroundColor:s.cpu>80?_.error[500]:_.primary[500]}})}),e.jsxs("span",{className:t.metricValue,children:[s.cpu.toFixed(1),"%"]})]}),e.jsxs("div",{className:t.metric,children:[e.jsx("span",{className:t.metricLabel,children:"Memory"}),e.jsx("div",{className:t.progressBar,children:e.jsx("div",{className:t.progressFill,style:{width:`${s.memory/s.memoryLimit*100}%`,backgroundColor:s.memory/s.memoryLimit>.8?_.error[500]:_.success[500]}})}),e.jsxs("span",{className:t.metricValue,children:[(s.memory/1024).toFixed(1)," /"," ",(s.memoryLimit/1024).toFixed(1)," GB"]})]})]})]})});E.displayName="ContainerItem";const L=()=>{const{dashboardData:s,onNavigate:a}=h();if(!s)return null;const{topContainers:n}=s,r=i=>{a("containers",i)};return e.jsxs("div",{className:t.section,children:[e.jsxs("div",{className:t.sectionHeader,children:[e.jsx("h2",{children:"Top Containers"}),e.jsx("button",{className:t.linkButton,onClick:()=>a("containers"),children:"View All"})]}),e.jsx("div",{className:t.containersList,children:n.map(i=>e.jsx(E,{container:i,onClick:r},i.id))})]})};L.displayName="ContainersSection";const H=()=>{const{dashboardData:s}=h();if(!s)return null;const{recentActivity:a}=s;return e.jsxs("div",{className:t.activitySection,children:[e.jsx("div",{className:t.sectionHeader,children:e.jsx("h2",{children:"Recent Activity"})}),e.jsx("div",{className:t.activityTimeline,children:a.map((n,r)=>e.jsxs("div",{className:t.activityItem,children:[e.jsx("div",{className:t.activityDot}),r<a.length-1&&e.jsx("div",{className:t.activityLine}),e.jsxs("div",{className:t.activityContent,children:[e.jsx("p",{children:n.message}),e.jsx("span",{className:t.activityTime,children:A(n.timestamp)})]})]},n.id))})]})};H.displayName="ActivityTimeline";const B=()=>{const{loading:s,error:a,isDarkMode:n}=h();return s?e.jsxs("div",{className:t.loadingContainer,children:[e.jsx("div",{className:t.spinner}),e.jsx("p",{children:"Loading dashboard..."})]}):a?e.jsxs("div",{className:t.errorContainer,children:[e.jsx(q,{size:48,color:d("error","500",n)}),e.jsx("h2",{children:"Failed to Load Dashboard"}),e.jsx("p",{children:a||"No data available"}),e.jsxs("p",{style:{fontSize:"0.875rem",color:d("neutral","500",n),marginTop:"1rem"},children:["Make sure your Flask backend is running:"," ",e.jsx("code",{children:"docker compose up -d"})]})]}):null};B.displayName="DashboardEmpty";const gs=()=>{const{loading:s,dashboardData:a}=h();return s||!a?e.jsx(B,{}):e.jsxs("div",{className:t.dashboard,style:{},children:[e.jsx(T,{}),e.jsx(I,{}),e.jsxs("div",{className:t.contentGrid,children:[e.jsx(w,{}),e.jsx(L,{})]}),e.jsx(H,{})]})},Cs=({isDarkMode:s,onToggleDarkMode:a})=>{const{dashboardData:n,loading:r,error:i}=os(),{isDarkMode:c,toggleTheme:o}=ls(s),{toAlerts:u,toContainers:y}=ds(),m=a??o,g=l.useCallback(($,vs)=>{switch($){case"alerts":u();break;case"containers":y();break}},[u,y]),R=l.useMemo(()=>n?.summary?.systemMetrics?.memory?n.summary.systemMetrics.memory.percentage.toFixed(1):"0",[n?.summary?.systemMetrics?.memory]);return e.jsx(ms,{dashboardData:n,loading:r,error:i,isDarkMode:c,onToggleDarkMode:m,onNavigate:g,memoryPercentage:parseFloat(R),children:e.jsx("div",{className:`${t.dashboard} ${c?t.dark:t.light}`,children:e.jsx(gs,{})})})};export{Cs as default};
